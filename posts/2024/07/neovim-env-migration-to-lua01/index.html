<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:type" content="article"><meta property="og:url" content="https://roodolv.dev/posts/2024/07/neovim-env-migration-to-lua01/"><meta property="og:image" content="https://roodolv.dev/img/favicon.png"><meta property="og:title" content="NeovimをLua環境に移行する その1 - dolvlog"><meta property="og:site_name" content="dolvlog"><meta property="og:description" content><meta name=twitter:card content="summary"><meta name=twitter:image content="img/favicon.png"><meta name=twitter:title content="NeovimをLua環境に移行する その1 - dolvlog"><meta name=twitter:creator content="@roodolv"><meta name=generator content="Hugo 0.111.3"><title>NeovimをLua環境に移行する その1 - dolvlog</title><meta name=description content="色々と一段落したので久々に更新
要約 2024年4月ごろ、余裕が出てきたのでRustに慣れる目的で簡単なツールを自作したりしていた
その時はVSCodeを使って書いていたのだが、「やはりNeovimでRustを書きたい」と思うようになり……
結果として、2020年から約4年ぶりにNeovimを全面的..."><link rel="shortcut icon" href=img/favicon.png><link rel=stylesheet href=/css/ui.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/fonts.css><script defer src=/js/dark-mode.js></script>
<link disabled id=dark-mode-theme rel=stylesheet href=/css/dark.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=/><img class=icon-text src=/img/prev.svg></a></li><li><img class=icon-text id=dark-mode-toggle src=/img/moon-regular.svg alt="Toggle Dark Mode"></a></li><li><a href=/about>About</a></li><li><a href=/posts/>Posts</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>NeovimをLua環境に移行する その1</h1><h5><time datetime="2024-07-13 00:02:43 +0900 +0900">2024-07-13</time>
<span class="no-print post-header">-
<a href=/tags/neovim>#neovim</a>
<a href=/tags/neovim-plugins>#neovim-plugins</a>
<a href=/tags/lua>#lua</a>
<a href=/tags/rust>#rust</a>
<span></h5></hgroup><hr class=sep></header><p>色々と一段落したので久々に更新</p><h3 id=要約>要約</h3><p>2024年4月ごろ、余裕が出てきたのでRustに慣れる目的で<a href=https://github.com/roodolv/sts-observer>簡単なツール</a>を自作したりしていた</p><p>その時はVSCodeを使って書いていたのだが、「やはりNeovimでRustを書きたい」と思うようになり……</p><p>結果として、<strong>2020年から約4年ぶり</strong>にNeovimを全面的にLuaへ移行することを決意した</p><h3 id=これまでやっていたこと>これまでやっていたこと</h3><p>2024年3月頃から現在まで、下記のようなことをやっていた</p><ul><li>Rustの技術書を1冊消化</li><li>Rustで簡易ツールを作成</li><li>NeovimのLua環境への全面移行</li><li>WindowsTerminalからWezTermへの移行</li><li>その他dotfilesなどの見直し</li><li>LuaでNeovimプラグイン開発</li></ul><h3 id=rust製の簡易ツールについて>Rust製の簡易ツールについて</h3><p>今年、人気ゲームSlay the Spireの続編『Slay the Spire 2』が<a href=https://www.famitsu.com/news/202404/11339065.html>発表</a>された</p><p>ニュースでゲームのことを思い出して久々にプレイしてみたりしたが、その途中で「オートセーブデータの状態を監視するツール」を思いつき、試しに作ってみることにした</p><p>それがこちら</p><ul><li><a href=https://github.com/roodolv/sts-observer>roodolv/sts-observer</a></li></ul><p>OBSなどのツールで画面上に表示できるよう、オートセーブ内の各種パラメータを <code>.txt</code> 形式で出力するツールだ</p><p>主にRustとFSM(有限状態機械、有限オートマトン)の実装慣れの為に学習目的で作ってみたもので、実装は汚く、<strong>実用性は特にない</strong> <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>と思う</p><p>ただ、これを作ったことで改めて「Rustは書きやすい<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>な」と実感すると同時に、VSCodeだけでなくNeovimの開発環境をしっかり作り込む必要があると感じた</p><h3 id=vscodeだけでなくneovimも使いたくなる>VSCodeだけでなくNeovimも使いたくなる</h3><p>元々Neovimは軽い設定ファイル(TOMLやJSONなど)を弄る時に高速で立ち上げて使う程度で、コーディングは主にVSCodeですることが多かった</p><p>手元で使うPythonスクリプトを書く時などにもJupyter NotebookのVSCode拡張機能があるのでそちらを利用することが多かった</p><p>また、VSCodeには<a href=https://github.com/VSCodeVim/Vim>vscodevim</a>やGit関連など一通りの拡張機能も入れ、コーディングが最低限できるぐらいには環境構築を済ませていたのだが……</p><p>しかし……</p><p>やはりVSCode上でVimキーバインドを利用しても、IME周りでちょっと不審な挙動<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>をしていたり、vscode-vimのキーバインドがVSCode側のショートカットと重複してしまったり、不都合が多々あった</p><p>VSCodeで書けば書くほど、いつの間にか「Neovimの書き心地でRustが書けたら楽なのにな……」と思うようになった</p><h3 id=neovimのlua環境移行を決意>NeovimのLua環境移行を決意</h3><p>Neovimについて調べているうちに、当時使っていたプラグインマネージャーの<a href=https://github.com/Shougo/dein.vim>dein.vim</a>からの移行の必要性を強く感じるようになった</p><p>以前はLSP等に関しても<a href=https://github.com/neoclide/coc.nvim>coc.nvim</a>などを入れるのが主流だったように記憶しているが、4年ぶりに見てみると全く以て情勢が変わっていた</p><p>ちなみに自分が元々Neovimで使っていたプラグイン一覧はここにまとまっている</p><ul><li><a href=https://github.com/roodolv/dotfiles/blob/f44380f6d9e50734ea9d05bf8cdc6df3e969ebdd/.config/nvim/dein.toml>dein.toml</a></li><li><a href=https://github.com/roodolv/dotfiles/blob/f44380f6d9e50734ea9d05bf8cdc6df3e969ebdd/.config/nvim/dein_lazy.toml>dein_lazy.toml</a></li></ul><p>しかし現在、LSPはNeovimの <strong>ネイティブLSPが強力な機能としてユーザーからの信頼を集めており</strong>、またLua系で書かれたプラグインを<a href=https://github.com/folke/lazy.nvim>lazy.nvim</a>や<a href=https://github.com/wbthomason/packer.nvim>packer.nvim</a>などで管理する人が増えているらしかった</p><p>また、GitHubで様々なNeovimプラグインを見ていると、<strong>ある共通点</strong>があることに気づいた</p><ul><li>各プラグインが<strong>特定のプラグイン</strong>との連携機能を提供<ul><li><a href=https://github.com/nvim-telescope/telescope.nvim>telescope.nvim</a>、<a href=https://github.com/hrsh7th/nvim-cmp>nvim-cmp</a>など</li></ul></li><li>古くからあるVimプラグインの<strong>代替となるLua製プラグイン</strong>が登場<ul><li><a href=https://github.com/tpope/vim-surround>vim-surround</a>に対する<a href=https://github.com/kylechui/nvim-surround>nvim-surround</a>や</li><li><a href=https://github.com/jiangmiao/auto-pairs>auto-pairs</a>に対する<a href=https://github.com/windwp/nvim-autopairs>nvim-autopairs</a>など</li></ul></li></ul><p>どうやら人気を集めている強力なLua製プラグインが複数存在し、そのプラグインを中心に新たなエコシステムが形成されているらしいことが分かって来た</p><p>dein.vimも別に嫌ではないのだが、TOMLで管理するよりプログラマブルなLuaで管理する方が柔軟性が高そうだった</p><p>ということで、調べれば調べるほどLua系の環境へ移行した方が良いことに気づき、<strong>Neovimのプラグインも全面的に見直してしまう</strong>ことにした</p><h3 id=おわりに>おわりに</h3><p>今回はここまで</p><p>次回以降はNeovimのLua環境への移行について書いていく</p><p>ただし移行作業中に取った<strong>メモが15000行以上</strong>に及ぶので、経過をただこのブログに書くことはせず、人の役に立ちそうな内容に極力絞っていきたいと思う</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>配信などをされる方はもしかしたら使えるかも知れないが、発売から日が経っているので実質的に意味のないツール&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>やはりコンパイラが優秀なので実行時以前にエラーをほぼ解消できるのが大きい。あと引数の渡し方がC++で言うconst参照に近いのも良い&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>変換中の単語以外に余計な文字が表示されたりetc&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><hr><nav class="no-print post-nav"><div class=prev-post><a href=https://roodolv.dev/posts/2024/03/vscode-rust-settings/><img class=icon-text src=/img/prev.svg>VSCodeのRustまわりの環境を見直した</a></div><div class=next-post></div></nav><script src=https://utteranc.es/client.js repo issue-term=url label theme=github-light crossorigin=anonymous async></script><div id=disqus_thread class=no-print></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=mailto:roodolv0x00@gmail.com><img class=icon-social src=/img/email.svg alt="Email Me!"></a>
<a href=https://github.com/roodolv/><img class=icon-social src=/img/github.svg alt=Github></a>
<a href=https://twitter.com/roodolv><img class=icon-social src=/img/twitter.svg alt=Twitter></a>
<a href=https://bsky.app/profile/roodolv.bsky.social><img class=icon-social src=/img/bluesky.svg alt=Bluesky></a>
<a href=https://roodolv.dev/index.xml target=_blank><img class=icon-social src=/img/feed.svg alt=Feed></a><p>&copy; 2023-2024
roodolv
| <a href=/license>License</a></p><a href=#brand><img class=icon-text src=/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/hybrid.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js></script>
<script src=/js/code-block-wrapper.js></script>
<script src=/js/code-lang-name.js></script>
<script src=/js/code-row-number.js></script>
<script>hljs.highlightAll()</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js></script>
<script src=/js/code-copy-button.js></script></body></html>