<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:type" content="article"><meta property="og:url" content="https://roodolv.dev/posts/2024/09/obsidian-remotely-save/"><meta property="og:image" content="https://roodolv.dev/img/favicon.png"><meta property="og:title" content="ObsidianのRemotely Saveを利用してみた - dolvlog"><meta property="og:site_name" content="dolvlog"><meta property="og:description" content><meta name=twitter:card content="summary"><meta name=twitter:image content="img/favicon.png"><meta name=twitter:title content="ObsidianのRemotely Saveを利用してみた - dolvlog"><meta name=twitter:creator content="@roodolv"><meta name=generator content="Hugo 0.111.3"><title>ObsidianのRemotely Saveを利用してみた - dolvlog</title><meta name=description content="2か月ほどブログ更新が滞ってしまっていたので久々に更新
要約 表題の通りObsidianのRemotely Saveプラグインを試してみようと思っていたので、今回色々やってみた
Encryption Passwordは一番最初に設定すること(重要) Cloudflare R2とDropboxを試した..."><link rel="shortcut icon" href=img/favicon.png><link rel=stylesheet href=/css/ui.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/fonts.css><script defer src=/js/dark-mode.js></script>
<link disabled id=dark-mode-theme rel=stylesheet href=/css/dark.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway"></head><body><header class="container no-print"><div class=u-header><nav class=bar><ul><li><a href=/><img class=icon-text src=/img/prev.svg></a></li><li><img class=icon-text id=dark-mode-toggle src=/img/moon-regular.svg alt="Toggle Dark Mode"></a></li><li><a href=/about>About</a></li><li><a href=/posts/>Posts</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></header><main class=container><article><header><hgroup id=brand><h1>ObsidianのRemotely Saveを利用してみた</h1><h5><time datetime="2024-09-21 20:29:42 +0900 +0900">2024-09-21</time>
<span class="no-print post-header">-
<a href=/tags/obsidian>#obsidian</a>
<a href=/tags/cloudflare>#cloudflare</a>
<a href=/tags/r2>#r2</a>
<a href=/tags/dropbox>#dropbox</a>
<a href=/tags/file-sync>#file-sync</a>
<span></h5></hgroup><hr class=sep></header><p>2か月ほどブログ更新が滞ってしまっていたので久々に更新</p><h3 id=要約>要約</h3><p>表題の通り<a href=https://obsidian.md/>Obsidian</a>の<a href=https://github.com/remotely-save/remotely-save>Remotely Save</a>プラグインを試してみようと思っていたので、今回色々やってみた</p><ul><li>Encryption Passwordは一番最初に設定すること(重要)</li><li>Cloudflare R2とDropboxを試したがサービス間の同期速度差は体感上なし<ul><li>それよりも端末間のスペック差の方が同期速度への影響が大きいと思われる</li></ul></li><li>スマホからはRead Onlyで使うことに</li></ul><h3 id=obsidianのremotely-saveについて>ObsidianのRemotely Saveについて</h3><p>これはObsidianを利用している人には有名なプラグインで、要するにMarkdownなどの <strong>メモを暗号化してクラウドストレージに保管し、端末間で同期してくれる</strong> という優れものだ</p><p>暗号化は <strong>End-to-end(E2E) encryption</strong> で行われ、暗号化方式はRClone Crypt(デフォルト)かOpenSSL encかの二択となっている</p><p><a href="htts://github.com/remotely-save/remotely-save?tab=readme-ov-file#features">GitHub公式リポジトリの説明</a>にもある通り、AWSのS3やDropboxやWebDAVなど様々なサービス・機能が同期用ストレージとして利用可能なのだが、今回自分は</p><ul><li>Dropbox</li><li>Cloudflare R2 (S3準拠)</li></ul><p>の2つでテストしてみた</p><p>プラグインのインストール方法などは省略</p><h3 id=remotely-saveを利用する際の注意点>Remotely Saveを利用する際の注意点</h3><h4 id=暗号化パスワードについて>暗号化パスワードについて</h4><p>もし平文ではなく <strong>暗号化されたメモ</strong> をクラウドストレージに置きたい場合、必ず <strong>一番初めに「Encryption Password」を設定</strong> することをおすすめする</p><p>当然だが、クラウドサービス利用時にAPIエンドポイントのURLやアクセスキーIDなどの必要情報を先に一通り入力し、そのまま同期してしまうと <strong>メモが平文のままアップロードされてしまう</strong></p><p>パスワード設定項目はRemotely Save設定画面の最上部より少し下へスクロールした辺りにあるので注意</p><p><img src=/posts/drafts/img/2024-09/remotely-save-config01.png alt></p><p>上記画像にも書いてあるように「Confirm」をクリックしてパスワードを設定しないと有効にならない点にも注意</p><p>また、Remotely Saveの設定画面最下部に「Reset」ボタンがあるが、このResetを実行する度にプラグインを再度読み込むらしいので、自分はResetした場合には一応Encryption PasswordのConfirmを再度実行してから同期することにしている</p><h4 id=従量課金に注意>従量課金に注意</h4><p>連携するクラウド系サービスによっては従量課金になっている点に注意が必要だ</p><p>例えば今回利用した <strong>Cloudflare R2も従量課金</strong> となっている</p><ul><li>公式資料: <a href=https://developers.cloudflare.com/r2/pricing/>https://developers.cloudflare.com/r2/pricing/</a></li></ul><p>具体的には、下記の通り</p><ul><li>ストレージ: <strong>10GB/月</strong> まで無料</li><li>ClassA操作(≒書き込み): <strong>100万回/月</strong> まで無料</li><li>ClassB操作(≒読み込み): <strong>1000万回/月</strong> まで無料</li><li>エグレス: 無料</li></ul><p>なお厳密なClassA操作とClassB操作の内訳は下記の通りらしい</p><blockquote><p>Class A Operations include <code>ListBuckets</code>, <code>PutBucket</code>, <code>ListObjects</code>, <code>PutObject</code>, <code>CopyObject</code>, <code>CompleteMultipartUpload</code>, <code>CreateMultipartUpload</code>, <code>LifecycleStorageTierTransition</code>, <code>ListMultipartUploads</code>, <code>UploadPart</code>, <code>UploadPartCopy</code>, <code>ListParts</code>, <code>PutBucketEncryption</code>, <code>PutBucketCors</code> and <code>PutBucketLifecycleConfiguration</code>.</p></blockquote><blockquote><p>Class B Operations include <code>HeadBucket</code>, <code>HeadObject</code>, <code>GetObject</code>, <code>UsageSummary</code>, <code>GetBucketEncryption</code>, <code>GetBucketLocation</code>, <code>GetBucketCors</code> and <code>GetBucketLifecycleConfiguration</code>.</p></blockquote><h3 id=remotely-saveでcloudflare-r2を利用する方法>Remotely SaveでCloudflare R2を利用する方法</h3><p>一応メモしておく</p><h4 id=cloudflare-r2用に支払い手段を登録する>Cloudflare R2用に支払い手段を登録する</h4><p>Cloudflareアカウントを持っていない場合はここで作成する必要がある</p><p>既にCloudflareアカウントがある場合はCloudflareのログイン済みダッシュボード(Dashboard)から左側の「R2」を選択すればR2サービスの利用開始画面に移動する</p><p>あとは指示通りにクレジットカードかPayPalの登録をすればR2サービスが利用できるようになる</p><p><a href=/posts/2024/02/domain-transfer-to-cloudflare>以前の記事</a>でも書いたように、自分はドメイン管理やリバースプロキシなどでCloudflareは既に利用していたので、そのままPayPalを支払い手段としてR2を利用することにした</p><h4 id=r2用のバケットを作成する>R2用のバケットを作成する</h4><p>R2を利用するために <strong>バケット(Bucket)</strong> を作成する</p><p>URLの一部になるらしいのでハイフンなどで繋げつつ適当な名前で作ってみた</p><ul><li>名前: <code>obsidian-remotely-save</code></li><li>位置情報(リージョン): <strong>自動</strong></li><li>デフォルトのストレージクラス: <strong>Standard</strong></li></ul><p>にしておいた</p><p>作成したバケットの設定画面を見ると、このようにAPIエンドポイント用のURLが表示される(S3 APIの部分)
<img src=/posts/drafts/img/2024-09/remotely-save-config02.png alt></p><p><code>https://</code>から<code>cloudflarestorage.com</code>まで(末尾スラッシュなし)がRemotely Saveプラグインに求められる部分なので一応メモしておくと良い</p><p>ちなみにリージョンは自動で「アジア太平洋(APAC)」になった</p><h4 id=apiアクセス用トークンを作成する>APIアクセス用トークンを作成する</h4><p>トークン名は自分が分かればいいので適当なものにする</p><p>権限とバケット指定は下記の通りにした</p><ul><li>権限: <strong>オブジェクト読み取りと書き込み</strong></li><li>バケットの指定: <strong>特定のバケットにのみ適用</strong><ul><li>作成したバケット名<code>obsidian-remotely-save</code>を指定</li></ul></li></ul><p><img src=/posts/drafts/img/2024-09/remotely-save-config03.png alt></p><p>他の方の記事では「管理者読み取りと書き込み」にしないとダメだったという意見を見たが、自分の環境では「オブジェクト読み取りと書き込み」で十分に同期可能だった(環境によるのかも知れない)</p><h4 id=アクセスキーidとシークレットアクセスキーをメモしておく>アクセスキーIDとシークレットアクセスキーをメモしておく</h4><p>APIトークンを作成すると、 <strong>一度だけ</strong> 画面上にアクセスキーIDとシークレットアクセスキーが表示されるので必ずメモしておく</p><p><img src=/posts/drafts/img/2024-09/remotely-save-config04.png alt></p><p>これらの情報はあとでRemotely Saveプラグインの設定時に必要不可欠なので絶対に見落とさないようにしたい</p><h4 id=obsidianのremotely-save設定画面から必要事項を入力>ObsidianのRemotely Save設定画面から必要事項を入力</h4><p>あとは下記の通り、ObsidianのプラグインRemotely Save設定画面から各種情報を入力することで同期の準備が完了する</p><ul><li>Choose A Remote Service: <strong>S3 or compatible</strong></li><li>Endpoint</li><li>Region</li><li>Access Key ID</li><li>Secret Access Key</li><li>Bucket Name</li></ul><p><img src=/posts/drafts/img/2024-09/remotely-save-config05.png alt></p><p>Regionは<code>us-east-1</code>にしておくと良い、と書いてあるが自分は<code>auto</code>にしておいた</p><h4 id=remotely-saveで同期開始>Remotely Saveで同期開始</h4><p>これで準備完了だが、念のためRemotely Save設定画面から <strong>Check Connectivity</strong> のCheckボタンをクリックして同期可能かどうか確認しておくと良い</p><p>必要事項入力後、Obsidianのコマンドパレット上から「Remotely Save: start sync」を選択するか、左側のリボンから「Remotely Save」の矢印アイコンをクリックするとその場で同期が開始される</p><p>あとは別端末のObsidianの方でも同様にRemotely Saveプラグインの設定をし、同じ暗号化パスワードを入れれば暗号化されたデータが復号されて保存・同期される</p><h3 id=remotely-saveの使い心地など>Remotely Saveの使い心地など</h3><h4 id=自分のobsidian環境について>自分のObsidian環境について</h4><p>自分のObsidianには凡そ6000超のファイルが含まれており、うち2000ほどは画像・PDFなどのファイル群、残り4000ほどがMarkdownファイルという構成になっている</p><h4 id=問題発生-同期の速度が端末ごとに大きく異なる>問題発生: 同期の速度が端末ごとに大きく異なる</h4><p>上記の通りファイル数がやや多め(？)だったことが災いしたのか、スマホから同期しようとすると <strong>数行のファイル変更差分を同期するだけで10～40分かかってしまう</strong> ことが今回分かった</p><p>例えばPC上からの同期は <strong>数秒で終わる</strong> のに、iPhone SE(第二世代)などで同期を行うと数十分かかったりする</p><h4 id=いろいろ検証してみた>いろいろ検証してみた</h4><p>原因を特定しようと思い、</p><ul><li>連携するクラウドサービス(DropboxとCloudflare R2)を切り替えたり</li><li>スマホを再起動してメモリを空けたり</li><li>Vault内にある全画像の解像度をリサイズするなどしてバイナリ系の総ファイルサイズを半減させたり</li><li>ネットワークを切り替えてみたり</li><li>etc</li></ul><p>様々な検証をしてみた(下記はファイルサイズを半分に減らした時のR2ストレージの推移)</p><p><img src=/posts/drafts/img/2024-09/remotely-save-config06.png alt></p><p>しかしどれも効果は乏しく、利用するサービスやネットワークの速度、ファイルサイズも直接的な要因ではないようだった</p><p>むしろ、ローカルの端末スペックに依存している(？)様子だった</p><p>やはりiPhone SE(第二世代)のロースペックぶりが足を引っ張っているのだろうか……？</p><h4 id=同期速度低下の原因について推測>同期速度低下の原因について推測</h4><p>重要なのが、クラウドサービスにおいてDropbox(のAPI)を使う場合とCloudflare R2を使う場合の <strong>速度差は体感上ほぼ無かった</strong> ということだ</p><p>どちらを使った場合もPCからのアップロードとダウンロード(fetch)に関してはスムーズに済む一方、スマホからだとどうしてもモタついてしまうことが分かった</p><p>恐らくだが、動画ファイルなど比較的ファイルサイズの大きめ<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>なバイナリファイルがObsidianのVault内にある場合に、Remotely Saveプラグイン本体がローカルキャッシュ(DB)とクラウド上のオブジェクトとの差分を走査＆検出しようとするが、ロースペックのスマホだとそれをこなす能力が足りず、結果として遅くなっているのでは……と推測している</p><h4 id=readonlyで使うならまぁまぁの使い心地>ReadOnlyで使うならまぁまぁの使い心地</h4><p>とにかく自分の環境だと <strong>スマホからの同期が実用レベルにない速度</strong> となってしまった為、現時点では双方向のWriteは諦め、スマホの方からはRead Only用途で使うことにした</p><p>クラウドサービスについてはCloudflare R2もDropboxも両方利用可能な状態にしてあるが、今の所Dropboxを利用している</p><p>とは言え、Read Onlyでもやはり <strong>Vault全体を暗号化し、クラウドで同期できるのは非常に有難い</strong></p><p>スマホ版Obsidianアプリはまだまだ発展途上という感じはするが、現時点で既に使い心地は十分良好なので今後にも期待したい</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>とは言っても自分のVault内で最大のファイルサイズは28.1MBで、10MB以上のファイルも全部で6つしかないのだが&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><hr><nav class="no-print post-nav"><div class=prev-post><a href=https://roodolv.dev/posts/2024/07/neovim-env-migration-to-lua02/><img class=icon-text src=/img/prev.svg>NeovimをLua環境に移行する 第2回</a></div><div class=next-post></div></nav><script src=https://utteranc.es/client.js repo issue-term=url label theme=github-light crossorigin=anonymous async></script><div id=disqus_thread class=no-print></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><hr class=sep></main><footer class="container no-print"><div class=u-footer><a href=mailto:roodolv0x00@gmail.com><img class=icon-social src=/img/email.svg alt="Email Me!"></a>
<a href=https://github.com/roodolv/><img class=icon-social src=/img/github.svg alt=Github></a>
<a href=https://twitter.com/roodolv><img class=icon-social src=/img/twitter.svg alt=Twitter></a>
<a href=https://bsky.app/profile/roodolv.bsky.social><img class=icon-social src=/img/bluesky.svg alt=Bluesky></a>
<a href=https://roodolv.dev/index.xml target=_blank><img class=icon-social src=/img/feed.svg alt=Feed></a><p>&copy; 2023-2024
roodolv
| <a href=/license>License</a></p><a href=#brand><img class=icon-text src=/img/toup.svg alt="To Up">
<span>Back to Up</span></a></div></footer><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/hybrid.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js></script>
<script src=/js/code-block-wrapper.js></script>
<script src=/js/code-lang-name.js></script>
<script src=/js/code-row-number.js></script>
<script>hljs.highlightAll()</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js></script>
<script src=/js/code-copy-button.js></script></body></html>